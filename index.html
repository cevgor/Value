<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>D!CKP!C DEFENSE</title>

<style>
html,body{
  margin:0;
  padding:0;
  font-family:system-ui, sans-serif;
  touch-action:manipulation;
  background:linear-gradient(180deg,#1b0036,#090014);
  color:#fff;
}
canvas{display:block}

#menu, #shop {
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,#2c0055,#12001f);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:20;
}

button{
  background:linear-gradient(135deg,#ff00cc,#3333ff);
  border:none;
  color:white;
  padding:14px 24px;
  font-size:18px;
  border-radius:14px;
  margin:10px;
}

#topbar{
  position:fixed;
  top:0;
  width:100%;
  padding:6px;
  background:rgba(0,0,0,.4);
  display:flex;
  justify-content:space-around;
  z-index:10;
  font-size:14px;
}

.tower-btn{
  background:#00000088;
  border-radius:12px;
  padding:8px;
  margin:6px;
  font-size:22px;
}
</style>
</head>

<body>

<div id="menu">
  <h1>ğŸš« D!CKP!C DEFENSE</h1>
  <p>Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ¸ Ñ‡Ğ°Ñ‚</p>
  <button onclick="startGame()">â–¶ Ğ˜Ğ“Ğ ĞĞ¢Ğ¬</button>
</div>

<div id="shop" style="display:none">
  <h2>Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ±Ğ°ÑˆĞ½Ğ¸</h2>
  <button class="tower-btn" onclick="selectTower(0)">ğŸ›¡ï¸ Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ (5ğŸ’°)</button>
  <button class="tower-btn" onclick="selectTower(1)">ğŸš« ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ (8ğŸ’°)</button>
  <button onclick="closeShop()">ĞĞ°Ğ·Ğ°Ğ´</button>
</div>

<div id="topbar">
  <span>â¤ï¸ <b id="lives">3</b></span>
  <span>ğŸ’° <b id="money">10</b></span>
  <span>ğŸŒŠ <b id="wave">1</b></span>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize(); addEventListener("resize",resize);

let game=false;
let lives=3, money=10, wave=1;
let enemies=[], towers=[], shots=[];
let currentTower=0;

const towerTypes=[
  {emoji:"ğŸ›¡ï¸",range:120,rate:50,price:5},
  {emoji:"ğŸš«",range:180,rate:30,price:8}
];

const enemyTypes=["ğŸ†","ğŸ“¸","ğŸ˜"];

function startGame(){
  document.getElementById("menu").style.display="none";
  game=true;
}

function selectTower(i){currentTower=i; closeShop();}
function closeShop(){document.getElementById("shop").style.display="none"}

canvas.addEventListener("touchstart",e=>{
  if(!game) return;
  const t=e.touches[0];
  const type=towerTypes[currentTower];
  if(money>=type.price){
    towers.push({x:t.clientX,y:t.clientY,type,cd:0});
    money-=type.price;
  }
});

function spawnWave(){
  for(let i=0;i<wave*3;i++){
    enemies.push({
      x:Math.random()*canvas.width,
      y:-Math.random()*300,
      speed:0.6+wave*0.1,
      emoji:enemyTypes[Math.floor(Math.random()*enemyTypes.length)]
    });
  }
}

spawnWave();

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ñ„Ğ¾Ğ½
  ctx.fillStyle="rgba(255,255,255,0.03)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  enemies.forEach((e,i)=>{
    e.y+=e.speed;
    ctx.font="32px serif";
    ctx.fillText(e.emoji,e.x,e.y);
    if(e.y>canvas.height){
      enemies.splice(i,1);
      lives--;
    }
  });

  towers.forEach(t=>{
    ctx.font="26px serif";
    ctx.fillText(t.type.emoji,t.x-12,t.y+12);
    t.cd--;
    if(t.cd<=0){
      const target=enemies.find(e=>Math.hypot(e.x-t.x,e.y-t.y)<t.type.range);
      if(target){
        shots.push({x:t.x,y:t.y,tx:target.x,ty:target.y});
        t.cd=t.type.rate;
      }
    }
  });

  shots.forEach((s,i)=>{
    s.x+=(s.tx-s.x)*0.15;
    s.y+=(s.ty-s.y)*0.15;
    ctx.font="18px serif";
    ctx.fillText("âŒ",s.x,s.y);
    enemies.forEach((e,ei)=>{
      if(Math.abs(s.x-e.x)<20 && Math.abs(s.y-e.y)<20){
        enemies.splice(ei,1);
        shots.splice(i,1);
        money++;
      }
    });
  });

  if(enemies.length===0){
    wave++;
    spawnWave();
  }

  lives<=0 && gameOver();

  document.getElementById("lives").textContent=lives;
  document.getElementById("money").textContent=money;
  document.getElementById("wave").textContent=wave;

  requestAnimationFrame(loop);
}

function gameOver(){
  game=false;
  ctx.fillStyle="#fff";
  ctx.font="28px system-ui";
  ctx.textAlign="center";
  ctx.fillText("Ğ§ĞĞ¢ ĞŸĞĞ›",canvas.width/2,canvas.height/2);
}

loop();
</script>
</body>
</html>
