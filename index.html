<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Про Фитнес: Трекер Питания и Фитнеса</title>
    <!-- Bootstrap CDN для красивого дизайна -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js для графиков -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Animate.css для анимаций -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            color: #333;
            font-family: 'Arial', sans-serif;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        h1, h2 {
            color: #4CAF50;
            text-align: center;
        }
        .btn-primary {
            background: #4CAF50;
            border: none;
        }
        .btn-primary:hover {
            background: #45a049;
        }
        #results, #tips {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
        }
        #food-search-results {
            max-height: 300px;
            overflow-y: auto;
        }
        .food-item {
            cursor: pointer;
            transition: background 0.3s;
        }
        .food-item:hover {
            background: #f0f0f0;
        }
        #food-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        #chart-container {
            margin-top: 30px;
        }
        .animate__animated {
            animation-duration: 1s;
        }
    </style>
</head>
<body>
    <div class="container animate__animated animate__fadeIn">
        <h1>Про Фитнес Трекер</h1>
        <p class="text-center">Помощник в похудении и наборе мышц: расчёт калорий, трекинг питания с базой из интернета (USDA API), графики и советы.</p>
        
        <!-- Форма для данных пользователя -->
        <h2>Ваши данные</h2>
        <form id="user-form" class="row g-3">
            <div class="col-md-6">
                <label for="age" class="form-label">Возраст (лет):</label>
                <input type="number" class="form-control" id="age" required>
            </div>
            <div class="col-md-6">
                <label for="gender" class="form-label">Пол:</label>
                <select class="form-select" id="gender" required>
                    <option value="male">Мужской</option>
                    <option value="female">Женский</option>
                </select>
            </div>
            <div class="col-md-6">
                <label for="height" class="form-label">Рост (см):</label>
                <input type="number" class="form-control" id="height" required>
            </div>
            <div class="col-md-6">
                <label for="weight" class="form-label">Вес (кг):</label>
                <input type="number" class="form-control" id="weight" required>
            </div>
            <div class="col-md-6">
                <label for="activity" class="form-label">Уровень активности:</label>
                <select class="form-select" id="activity" required>
                    <option value="1.2">Сидячий</option>
                    <option value="1.375">Лёгкая</option>
                    <option value="1.55">Умеренная</option>
                    <option value="1.725">Высокая</option>
                    <option value="1.9">Очень высокая</option>
                </select>
            </div>
            <div class="col-md-6">
                <label for="goal" class="form-label">Цель:</label>
                <select class="form-select" id="goal" required>
                    <option value="loss">Похудение</option>
                    <option value="gain">Набор мышц</option>
                </select>
            </div>
            <div class="col-12">
                <button type="button" class="btn btn-primary w-100" onclick="calculateCalories()">Рассчитать</button>
            </div>
        </form>
        
        <div id="results" class="animate__animated animate__fadeIn"></div>
        <div id="tips" class="animate__animated animate__fadeIn"></div>
        
        <!-- Трекинг питания -->
        <div id="food-tracker" class="mt-5">
            <h2>Трекинг питания</h2>
            <div class="input-group mb-3">
                <input type="text" class="form-control" id="food-search" placeholder="Поиск еды (на английском, напр. apple)">
                <button class="btn btn-outline-secondary" type="button" onclick="searchFood()">Искать</button>
            </div>
            <div id="food-search-results" class="list-group mb-3"></div>
            
            <ul id="food-list" class="list-group"></ul>
            <div id="total-calories" class="mt-3 fw-bold">Итого калорий: 0</div>
            
            <!-- Выбор даты для трекинга -->
            <div class="mt-3">
                <label for="date">Дата:</label>
                <input type="date" id="date" value="" onchange="loadDay()">
            </div>
        </div>
        
        <!-- График -->
        <div id="chart-container">
            <h2>График калорий за неделю</h2>
            <canvas id="calorie-chart"></canvas>
        </div>
    </div>

    <script>
        const API_KEY = 'DEMO_KEY'; // USDA demo key, для реального использования зарегистрируйся на https://fdc.nal.usda.gov/api-guide.html
        const USDA_API = 'https://api.nal.usda.gov/fdc/v1/foods/search';

        let dailyData = JSON.parse(localStorage.getItem('dailyData')) || {};
        let currentDate = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = currentDate;
        let chart;

        function calculateCalories() {
            const age = parseFloat(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const activity = parseFloat(document.getElementById('activity').value);
            const goal = document.getElementById('goal').value;

            let bmr;
            if (gender === 'male') {
                bmr = 66.5 + (13.75 * weight) + (5.003 * height) - (6.75 * age);
            } else {
                bmr = 655.1 + (9.563 * weight) + (1.850 * height) - (4.676 * age);
            }
            const tdee = bmr * activity;
            let recommended = goal === 'loss' ? tdee - 500 : tdee + 500;

            document.getElementById('results').innerHTML = `
                <p><strong>BMR:</strong> ${bmr.toFixed(2)} ккал (базовый метаболизм)</p>
                <p><strong>TDEE:</strong> ${tdee.toFixed(2)} ккал (общий расход)</p>
                <p><strong>Рекомендуемые калории:</strong> ${recommended.toFixed(2)} ккал для ${goal === 'loss' ? 'похудения (дефицит 500 ккал)' : 'набора (профицит 500 ккал)'}</p>
            `;

            const tips = goal === 'loss' ? `
                <p><strong>Советы для похудения:</strong></p>
                <ul>
                    <li>Создайте дефицит калорий: ешьте на 500 ккал меньше TDEE.</li>
                    <li>Увеличьте потребление белка (1.6-2.2 г/кг веса).</li>
                    <li>Добавьте кардио и силовые тренировки.</li>
                    <li>Пейте много воды, спите 7-9 часов.</li>
                </ul>
            ` : `
                <p><strong>Советы для набора мышц:</strong></p>
                <ul>
                    <li>Создайте профицит калорий: ешьте на 500 ккал больше TDEE.</li>
                    <li>Фокус на белке (1.6-2.2 г/кг), углеводах для энергии.</li>
                    <li>Тренируйтесь с отягощениями 3-5 раз в неделю.</li>
                    <li>Отслеживайте прогресс веса еженедельно.</li>
                </ul>
            `;
            document.getElementById('tips').innerHTML = tips;
        }

        async function searchFood() {
            const query = document.getElementById('food-search').value;
            if (!query) return;

            const response = await fetch(USDA_API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query, pageSize: 10, api_key: API_KEY })
            });
            const data = await response.json();
            const resultsDiv = document.getElementById('food-search-results');
            resultsDiv.innerHTML = '';

            if (data.foods) {
                data.foods.forEach(food => {
                    const calories = food.foodNutrients.find(n => n.nutrientName === 'Energy')?.value || 0;
                    const item = document.createElement('div');
                    item.className = 'list-group-item food-item animate__animated animate__fadeIn';
                    item.innerHTML = `${food.description} - ${calories} ккал/100г`;
                    item.onclick = () => addFood(food.description, calories);
                    resultsDiv.appendChild(item);
                });
            } else {
                resultsDiv.innerHTML = '<p>Ничего не найдено. Попробуйте на английском.</p>';
            }
        }

        function addFood(name, calories) {
            if (!dailyData[currentDate]) dailyData[currentDate] = [];
            dailyData[currentDate].push({ name, calories });
            saveData();
            renderFoods();
            document.getElementById('food-search').value = '';
            document.getElementById('food-search-results').innerHTML = '';
        }

        function removeFood(index) {
            dailyData[currentDate].splice(index, 1);
            saveData();
            renderFoods();
        }

        function renderFoods() {
            const list = document.getElementById('food-list');
            list.innerHTML = '';
            let total = 0;
            (dailyData[currentDate] || []).forEach((food, index) => {
                total += food.calories;
                const li = document.createElement('li');
                li.className = 'list-group-item animate__animated animate__fadeIn';
                li.innerHTML = `${food.name} - ${food.calories} ккал <button class="btn btn-sm btn-danger" onclick="removeFood(${index})">Удалить</button>`;
                list.appendChild(li);
            });
            document.getElementById('total-calories').innerText = `Итого калорий: ${total}`;
        }

        function loadDay() {
            currentDate = document.getElementById('date').value;
            renderFoods();
            updateChart();
        }

        function saveData() {
            localStorage.setItem('dailyData', JSON.stringify(dailyData));
        }

        function updateChart() {
            const ctx = document.getElementById('calorie-chart').getContext('2d');
            const dates = [];
            const calories = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                dates.push(dateStr);
                calories.push(dailyData[dateStr] ? dailyData[dateStr].reduce((sum, f) => sum + f.calories, 0) : 0);
            }

            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{ label: 'Калории', data: calories, borderColor: '#4CAF50', fill: false }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });
        }

        // Инициализация
        renderFoods();
        updateChart();
    </script>
</body>
</html>