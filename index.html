<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitLife — Твой фитнес-компаньон</title>

    <!-- Bootstrap 5 + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
        }
        .card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .nav-tabs .nav-link {
            border: none;
            border-radius: 0;
            font-weight: 600;
            color: #666;
        }
        .nav-tabs .nav-link.active {
            background: #667eea;
            color: white;
        }
        .tab-pane {
            padding: 25px;
            animation: fadeIn 0.6s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-primary {
            background: #667eea;
            border: none;
        }
        .btn-primary:hover {
            background: #764ba2;
        }
        .list-group-item {
            border-radius: 12px !important;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        .list-group-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        #total-calories {
            font-size: 1.4rem;
            font-weight: bold;
            color: #667eea;
        }
        #weight-chart-container {
            margin-top: 20px;
        }
        #water-intake {
            font-size: 1.2rem;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card animate__animated animate__fadeIn">
            <div class="card-header bg-white text-center py-4">
                <h1 class="mb-0 text-primary">FitLife</h1>
                <p class="text-muted">Твой личный помощник в фитнесе и здоровье</p>
            </div>

            <div class="card-body p-0">
                <!-- Вкладки -->
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <button class="nav-link active w-100" id="calc-tab" data-bs-toggle="tab" data-bs-target="#calc" type="button">
                            <i class="bi bi-calculator"></i> Калькулятор
                        </button>
                    </li>
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <button class="nav-link w-100" id="food-tab" data-bs-toggle="tab" data-bs-target="#food" type="button">
                            <i class="bi bi-basket"></i> Питание
                        </button>
                    </li>
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <button class="nav-link w-100" id="progress-tab" data-bs-toggle="tab" data-bs-target="#progress" type="button">
                            <i class="bi bi-graph-up"></i> Прогресс
                        </button>
                    </li>
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <button class="nav-link w-100" id="reminders-tab" data-bs-toggle="tab" data-bs-target="#reminders" type="button">
                            <i class="bi bi-bell"></i> Напоминания
                        </button>
                    </li>
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <button class="nav-link w-100" id="extras-tab" data-bs-toggle="tab" data-bs-target="#extras" type="button">
                            <i class="bi bi-droplet"></i> Дополнительно
                        </button>
                    </li>
                </ul>

                <div class="tab-content">
                    <!-- 1. Калькулятор -->
                    <div class="tab-pane fade show active" id="calc">
                        <!-- ... (остаётся без изменений) ... -->
                        <h4 class="text-center mb-4">Расчёт калорий</h4>
                        <form id="user-form" class="row g-3">
                            <div class="col-md-6"><input type="number" class="form-control" placeholder="Возраст" id="age" required></div>
                            <div class="col-md-6">
                                <select class="form-select" id="gender" required>
                                    <option value="male">Мужской</option>
                                    <option value="female">Женский</option>
                                </select>
                            </div>
                            <div class="col-md-6"><input type="number" class="form-control" placeholder="Рост (см)" id="height" required></div>
                            <div class="col-md-6"><input type="number" class="form-control" placeholder="Вес (кг)" id="weight" required></div>
                            <div class="col-md-6">
                                <select class="form-select" id="activity" required>
                                    <option value="1.2">Сидячий</option>
                                    <option value="1.375">Лёгкая</option>
                                    <option value="1.55">Умеренная</option>
                                    <option value="1.725">Высокая</option>
                                    <option value="1.9">Очень высокая</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <select class="form-select" id="goal" required>
                                    <option value="loss">Похудение</option>
                                    <option value="gain">Набор мышц</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-primary w-100" onclick="calculateCalories()">Рассчитать</button>
                            </div>
                        </form>
                        <div id="results" class="mt-4"></div>
                        <div id="tips" class="mt-3"></div>
                    </div>

                    <!-- 2. Питание -->
                    <div class="tab-pane fade" id="food">
                        <!-- ... (остаётся без изменений) ... -->
                        <h4 class="text-center mb-4">Дневник питания</h4>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="food-search" placeholder="Поиск еды (на англ.: apple, chicken...)" aria-label="Поиск еды">
                            <button class="btn btn-outline-primary" type="button" onclick="searchFood()">Поиск</button>
                        </div>
                        <div id="food-search-results" class="list-group mb-3" style="max-height:250px;overflow-y:auto;"></div>

                        <ul id="food-list" class="list-group mb-3"></ul>
                        <div id="total-calories" class="text-center">Итого: 0 ккал</div>

                        <div class="mt-3 text-center">
                            <label for="date" class="form-label">Дата:</label>
                            <input type="date" id="date" class="form-control w-auto d-inline-block" onchange="loadDay()">
                        </div>
                    </div>

                    <!-- 3. Прогресс -->
                    <div class="tab-pane fade" id="progress">
                        <h4 class="text-center mb-4">Калории и вес за неделю</h4>
                        <canvas id="calorie-chart" height="150"></canvas>
                        <div id="weight-chart-container">
                            <h5 class="mt-4">График веса</h5>
                            <canvas id="weight-chart" height="150"></canvas>
                            <div class="mt-3">
                                <input type="number" step="0.1" class="form-control w-50 mx-auto" id="current-weight" placeholder="Текущий вес (кг)">
                                <button class="btn btn-primary mt-2" onclick="addWeight()">Добавить вес на сегодня</button>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Напоминания -->
                    <div class="tab-pane fade" id="reminders">
                        <h4 class="text-center mb-4">Напоминания</h4>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="reminder-name" placeholder="Название (напр. Витамины)">
                            <input type="text" class="form-control" id="reminder-text" placeholder="Что напомнить (напр. Выпить таблетки)">
                            <input type="time" class="form-control" id="reminder-time">
                            <button class="btn btn-primary" onclick="addReminder()">Добавить</button>
                        </div>
                        <ul id="reminder-list" class="list-group"></ul>
                        <small class="text-muted d-block mt-3 text-center">
                            <i class="bi bi-info-circle"></i> Напоминания работают только пока вкладка открыта (браузер покажет уведомление).
                        </small>
                    </div>

                    <!-- 5. Дополнительно (Вода и т.д.) -->
                    <div class="tab-pane fade" id="extras">
                        <h4 class="text-center mb-4">Трекер воды</h4>
                        <p class="text-center">Рекомендуемо: ~2-3 литра в день</p>
                        <div class="text-center">
                            <button class="btn btn-primary btn-lg m-2" onclick="addWater(0.25)">+0.25 л</button>
                            <button class="btn btn-primary btn-lg m-2" onclick="addWater(0.5)">+0.5 л</button>
                            <button class="btn btn-primary btn-lg m-2" onclick="addWater(1)">+1 л</button>
                        </div>
                        <div id="water-intake" class="text-center">Сегодня: 0 л</div>
                        <button class="btn btn-outline-secondary mt-3 w-100" onclick="resetWater()">Сбросить на сегодня</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const API_KEY = 'DEMO_KEY';
        const USDA_API = 'https://api.nal.usda.gov/fdc/v1/foods/search';

        let dailyData = JSON.parse(localStorage.getItem('dailyData')) || {};
        let weightData = JSON.parse(localStorage.getItem('weightData')) || {};
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
        let waterData = JSON.parse(localStorage.getItem('waterData')) || {};
        let currentDate = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = currentDate;

        let calorieChart, weightChart;

        // Калькулятор (без изменений)
        function calculateCalories() {
            const age = parseFloat(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const activity = parseFloat(document.getElementById('activity').value);
            const goal = document.getElementById('goal').value;

            let bmr = gender === 'male'
                ? 66.5 + (13.75 * weight) + (5.003 * height) - (6.75 * age)
                : 655.1 + (9.563 * weight) + (1.850 * height) - (4.676 * age);

            const tdee = bmr * activity;
            const recommended = goal === 'loss' ? tdee - 500 : tdee + 500;

            document.getElementById('results').innerHTML = `
                <div class="alert alert-info">
                    <strong>BMR:</strong> ${bmr.toFixed(0)} ккал<br>
                    <strong>TDEE:</strong> ${tdee.toFixed(0)} ккал<br>
                    <strong>Цель:</strong> ${recommended.toFixed(0)} ккал/день
                </div>
            `;

            const tips = goal === 'loss'
                ? `<div class="alert alert-success">Советы: дефицит 500 ккал, белок 1.6–2.2 г/кг, кардио + силовые</div>`
                : `<div class="alert alert-success">Советы: профицит 500 ккал, белок 1.6–2.2 г/кг, тренировки с весом</div>`;
            document.getElementById('tips').innerHTML = tips;
        }

        // Поиск еды, добавление, удаление, рендер (без изменений)
        async function searchFood() { /* ... тот же код ... */ }
        function addFood(name, calories) { /* ... */ }
        function removeFood(index) { /* ... */ }
        function renderFoods() { /* ... обновить total и updateCharts() */ 
            // В конце renderFoods добавить updateCharts();
            updateCharts();
        }
        function loadDay() {
            currentDate = document.getElementById('date').value;
            renderFoods();
            renderWater();
            updateCharts();
        }

        // Графики
        function updateCharts() {
            // Калории
            const calCtx = document.getElementById('calorie-chart').getContext('2d');
            const calLabels = [];
            const calData = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const ds = d.toISOString().split('T')[0];
                calLabels.push(ds.slice(5));
                const cal = (dailyData[ds] || []).reduce((s, f) => s + f.calories, 0);
                calData.push(cal);
            }
            if (calorieChart) calorieChart.destroy();
            calorieChart = new Chart(calCtx, { /* ... тот же конфиг ... */ });

            // Вес
            const weightCtx = document.getElementById('weight-chart').getContext('2d');
            const weightLabels = Object.keys(weightData).sort();
            const weightValues = weightLabels.map(date => weightData[date]);
            if (weightChart) weightChart.destroy();
            weightChart = new Chart(weightCtx, {
                type: 'line',
                data: {
                    labels: weightLabels.map(l => l.slice(5)),
                    datasets: [{
                        label: 'Вес (кг)',
                        data: weightValues,
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118,75,162,0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
        }

        function addWeight() {
            const weight = parseFloat(document.getElementById('current-weight').value);
            if (!weight) return;
            weightData[currentDate] = weight;
            localStorage.setItem('weightData', JSON.stringify(weightData));
            document.getElementById('current-weight').value = '';
            updateCharts();
        }

        // Напоминания с названием
        function addReminder() {
            const name = document.getElementById('reminder-name').value.trim() || 'Напоминание';
            const text = document.getElementById('reminder-text').value.trim();
            const time = document.getElementById('reminder-time').value;
            if (!text || !time) return;

            const reminder = { name, text, time, id: Date.now() };
            reminders.push(reminder);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            renderReminders();
            scheduleReminder(reminder);

            document.getElementById('reminder-name').value = '';
            document.getElementById('reminder-text').value = '';
            document.getElementById('reminder-time').value = '';
        }

        function renderReminders() {
            const list = document.getElementById('reminder-list');
            list.innerHTML = '';
            reminders.forEach(r => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                li.innerHTML = `<strong>${r.name}</strong> <br> <small>${r.time} — ${r.text}</small>
                    <button class="btn btn-sm btn-danger" onclick="removeReminder(${r.id})">×</button>`;
                list.appendChild(li);
            });
        }

        function scheduleReminder(reminder) { /* ... тот же код, но в уведомлении: new Notification(reminder.name, { body: reminder.text }) */ 
            // Изменить на:
            new Notification(reminder.name, { body: reminder.text });
        }

        // Трекер воды
        function addWater(amount) {
            if (!waterData[currentDate]) waterData[currentDate] = 0;
            waterData[currentDate] += amount;
            localStorage.setItem('waterData', JSON.stringify(waterData));
            renderWater();
        }

        function resetWater() {
            waterData[currentDate] = 0;
            localStorage.setItem('waterData', JSON.stringify(waterData));
            renderWater();
        }

        function renderWater() {
            const todayWater = waterData[currentDate] || 0;
            document.getElementById('water-intake').innerText = `Сегодня: ${todayWater.toFixed(2)} л`;
        }

        // Инициализация
        renderFoods();
        renderWater();
        updateCharts();
        renderReminders();
        reminders.forEach(scheduleReminder);

        if (Notification.permission === "default") {
            Notification.requestPermission();
        }
    </script>
</body>
</html>